<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Muon DIY Image Classifier</title>
    <style>
      :root {
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        color: #111;
      }
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #f0f4ff, #fef6e4);
      }
      .card {
        background: #fff;
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
        width: min(640px, 90vw);
      }
      h1 {
        margin-top: 0;
        margin-bottom: 8px;
        font-size: 24px;
      }
      p {
        margin-top: 0;
        color: #444;
      }
      #dropzone {
        border: 2px dashed #3b82f6;
        border-radius: 12px;
        padding: 32px;
        text-align: center;
        background: #f8fbff;
        color: #1f2937;
        transition: background 0.2s ease, transform 0.2s ease;
      }
      #dropzone.dragover {
        background: #e8f0ff;
        transform: translateY(-2px);
      }
      #results {
        margin-top: 16px;
        padding: 0;
        list-style: none;
      }
      #results li {
        margin: 6px 0;
        padding: 8px 12px;
        border-radius: 8px;
        background: #f3f4f6;
        display: flex;
        justify-content: space-between;
      }
      #preview {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        display: none;
        margin-top: 12px;
      }
      .hidden {
        display: none;
      }
      .error {
        color: #b91c1c;
        background: #fef2f2;
        border: 1px solid #fecaca;
        padding: 12px;
        border-radius: 8px;
        margin-top: 12px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Drag an image to classify</h1>
      <p>Images are resized to 32x32 before being passed to the lightweight classifier binary.</p>
      <div id="dropzone">
        <p><strong>Drop an image here</strong> or click to browse.</p>
        <input type="file" id="fileInput" accept="image/*" class="hidden" />
        <img id="preview" alt="Preview" />
      </div>
      <ul id="results"></ul>
      <div id="error" class="error hidden"></div>
    </div>

    <script>
      const dropzone = document.getElementById("dropzone");
      const fileInput = document.getElementById("fileInput");
      const results = document.getElementById("results");
      const errorBox = document.getElementById("error");
      const preview = document.getElementById("preview");

      function resetUI() {
        results.innerHTML = "";
        errorBox.classList.add("hidden");
        errorBox.textContent = "";
      }

      function showError(message) {
        errorBox.textContent = message;
        errorBox.classList.remove("hidden");
      }

      async function classify(file) {
        resetUI();
        const form = new FormData();
        form.append("file", file);

        try {
          const response = await fetch("/api/classify", {
            method: "POST",
            body: form,
          });

          if (!response.ok) {
            const data = await response.json();
            throw new Error(data.detail || "Failed to classify image");
          }

          const data = await response.json();
          results.innerHTML = data.labels
            .map(
              (entry) =>
                `<li><span>${entry.label}</span><span>${entry.score.toFixed(3)}</span></li>`
            )
            .join("");
        } catch (err) {
          showError(err.message);
        }
      }

      function handleFiles(files) {
        if (!files || !files.length) return;
        const file = files[0];
        classify(file);

        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }

      dropzone.addEventListener("click", () => fileInput.click());

      dropzone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropzone.classList.add("dragover");
      });

      dropzone.addEventListener("dragleave", () => {
        dropzone.classList.remove("dragover");
      });

      dropzone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropzone.classList.remove("dragover");
        handleFiles(e.dataTransfer.files);
      });

      fileInput.addEventListener("change", (e) => handleFiles(e.target.files));
    </script>
  </body>
</html>
